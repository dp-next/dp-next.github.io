<script>
(() => {
  const toPath = (href) => {
    try {
      return new URL(href, window.location.origin).pathname;
    } catch {
      return href;
    }
  };

  const isEnglishPath = (pathname) =>
    pathname === "/en" || pathname === "/en/" || pathname.startsWith("/en/");

  const isDanishPath = (pathname) =>
    pathname === "/da" || pathname === "/da/" || pathname.startsWith("/da/");

  const getLanguagePaths = (pathname) => {
    if (isEnglishPath(pathname)) {
      let daPath = pathname.replace(/^\/en/, "/da");
      if (daPath === "/da") daPath = "/da/1homepage/index.html";
      return { daPath, enPath: pathname };
    }

    if (isDanishPath(pathname)) {
      let enPath = pathname.replace(/^\/da/, "/en");
      if (enPath === "/en") enPath = "/en/1homepage/index.html";
      return { daPath: pathname, enPath };
    }

    return { daPath: "/da/1homepage/index.html", enPath: "/en/1homepage/index.html" };
  };

  const { daPath, enPath } = getLanguagePaths(window.location.pathname);
  const isEn = isEnglishPath(window.location.pathname);

  document.querySelectorAll("a.dropdown-item").forEach((link) => {
    const txt = (link.textContent || "").toLowerCase();
    if (txt.includes("dansk")) {
      link.setAttribute("href", daPath);
    }
    if (txt.includes("english")) {
      link.setAttribute("href", enPath);
    }
  });

  const danishLabels = new Set(["deltager", "forsker", "om os"]);
  const englishLabels = new Set(["participant", "researcher", "who we are"]);
  const sharedLabels = new Set(["publications", "support"]);

  const shouldKeepLink = (link) => {
    const text = (link.textContent || "").trim().toLowerCase();
    const href = toPath(link.getAttribute("href") || "");

    if (text === "language") return true;
    if (text === "work packages") return true;
    if (text.includes("dansk") || text.includes("english")) return true;

    if (text.startsWith("wp")) {
      return isEn ? href.includes("/en/") : href.includes("/da/");
    }

    if (sharedLabels.has(text)) {
      return isEn ? href.includes("/en/") : href.includes("/da/");
    }

    if (isEn) {
      if (danishLabels.has(text)) return false;
      if (englishLabels.has(text)) return true;
    } else {
      if (englishLabels.has(text)) return false;
      if (danishLabels.has(text)) return true;
    }
    return true;
  };

  document.querySelectorAll(".navbar a.nav-link, .navbar a.dropdown-item").forEach((link) => {
    if (!shouldKeepLink(link)) {
      const li = link.closest("li");
      if (li) li.remove();
    }
  });

  const seenTopLevel = new Set();
  document.querySelectorAll(".navbar .navbar-nav > .nav-item > .nav-link").forEach((link) => {
    const key = (link.textContent || "").trim().toLowerCase();
    if (!key) return;
    if (seenTopLevel.has(key)) {
      const li = link.closest(".nav-item");
      if (li) li.remove();
      return;
    }
    seenTopLevel.add(key);
  });

  const brand = document.querySelector("a.navbar-brand");
  if (brand) {
    brand.setAttribute("href", isEnglishPath(window.location.pathname) ? "/en/1homepage/index.html" : "/da/1homepage/index.html");
  }
})();
</script>