<%
const workPackages = templateParams.workPackages || ["WP1", "WP2", "WP3", "WP4"];
const profileLinkText = templateParams.profileLinkText || "View full profile";

function profileHref(person) {
  if (person.href) {
    return person.href;
  }

  if (person.slug) {
    return `people/${person.slug}.html`;
  }

  return "#";
}
%>

<div class="wp-grid">
<% for (const wpName of workPackages) {
const wpPeople = items.filter((person) => person.wps && person.wps.includes(wpName));
const leader = wpPeople.find((person) => person.isLead);
const members = wpPeople.filter((person) => !person.isLead);
%>
<div class="wp-column">
<div class="wp-title">
<h3><%- wpName %></h3>
</div>

<% if (leader) { %>
<div class="wp-leader">
<div class="person-card leader-card">
<img
src="<%- leader.image %>"
alt="<%- leader.name %>"
class="profile-picture"
>

<div class="person-name">
<a class="person-name-link" href="<%- profileHref(leader) %>">
<%- leader.name %>
</a>
</div>

<% if (leader.role) { %>
<div class="person-role"><%- leader.role %></div>
<% } %>

<% if (leader.affiliation) { %>
<div class="person-affiliation"><%- leader.affiliation %></div>
<% } %>

<% if (leader.orcid) { %>
<div class="person-orcid">
ORCID:
<a href="https://orcid.org/<%- leader.orcid %>" target="_blank" rel="noopener noreferrer">
<%- leader.orcid %>
</a>
</div>
<% } %>

<% if (leader.wps && leader.wps.length) { %>
<div class="person-wps">Work packages: <%- leader.wps.join(", ") %></div>
<% } %>

<a class="person-profile-link" href="<%- profileHref(leader) %>">
<%- profileLinkText %>
</a>
</div>
</div>
<% } %>

<div class="wp-members">
<% for (const person of members) { %>
<div class="person-card member-card">
<img
src="<%- person.image %>"
alt="<%- person.name %>"
class="profile-picture"
>

<div class="person-name">
<a class="person-name-link" href="<%- profileHref(person) %>">
<%- person.name %>
</a>
</div>

<% if (person.role) { %>
<div class="person-role"><%- person.role %></div>
<% } %>

<% if (person.affiliation) { %>
<div class="person-affiliation"><%- person.affiliation %></div>
<% } %>

<% if (person.orcid) { %>
<div class="person-orcid">
ORCID:
<a href="https://orcid.org/<%- person.orcid %>" target="_blank" rel="noopener noreferrer">
<%- person.orcid %>
</a>
</div>
<% } %>

<% if (person.wps && person.wps.length) { %>
<div class="person-wps">Work packages: <%- person.wps.join(", ") %></div>
<% } %>

<a class="person-profile-link" href="<%- profileHref(person) %>">
<%- profileLinkText %>
</a>
</div>
<% } %>
</div>
</div>
<% } %>
</div>
